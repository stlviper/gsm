<!-- Modal for Add News -->
<div id="addNews" class="modal fade" role="dialog" tabindex="-1">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h2 class="modal-title">Add News</h2>
        <span class="orange">Required fields*</span>
      </div>
      <div id="newPostMessage" class="hide">
        <div class="modal-body indent">
          <h1 class="text-center"><span class="icon icon-thank-you-o" style="font-size: 150px;"></span></h1>
          <p class="text-center" style="font-size: 20px;">{{strings.News.NewsPost}}</p>
        </div>
        <div class="modal-footer">
          <button id="newsModalClose" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      <form id="newsPostForm" name="newsPostForm" action="/community/add-news-post" enctype="multipart/form-data" method="POST">
        <div class="modal-body">
          <div class="row">
            <div id="newsAlert" class="alert alert-warning hidden"></div>

            <div class="form-group">
              <div class="col-sm-12">
                <label for="Headline">Headline<span class="orange">*</span></label>
                <input class="form-control" type="text" name="headline" id="headline" placeholder="Headline"/>
                <br/>
              </div>
              <div class="errorTxt"></div>
            </div>

            <div class="form-group col-md-12">
              <label for="Community">Select Community</label>
              </br>
              <select id="id-sel-com" name="communityID">
                {{#each communities}}
                  <option data-urlfriendlyid="{{urlFriendlyID}}" value="{{_id}}">{{name}}</option>
                {{/each}}
              </select>
            </div>
            <div class="form-group">
              <div class="col-sm-6">
                <label>Publish Date<span class="orange">*</span></label>
                <div class="input-group">
                  <div id="releaseDateIconNew" class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </div>
                  <div class="add-date">
                    <input style="z-index: 10000" type="text" class="form-control pull-right" name="releaseDate"
                           id="releaseDateNew" placeholder="Publish Date">
                  </div>
                </div>
                <div class="errorTxt"></div>
                <br/>
              </div>
            </div>
            <div class="form-group col-md-12">
              <label for="category" data-original-title="Start typing any tag you wish and press the comma key to add it. Enter as many as you like." data-placement="right"
                     data-toggle="tooltip">Category Tags <span class="glyphicon glyphicon-question-sign"></span></label>
              <input class="form-control" id="category-new" name="categories" placeholder="Add tags to help categorize your news. Press the comma key after typing each tag.">
            </div>
            <div class="form-group col-md-12">
              <label for="content">Body Content<span class="orange">*</span></label>
              <textarea class="form-control ckeditor" id="content" name="content" placeholder="" rows="8"></textarea>
            </div>
            <div class="form-group col-lg-12">
              <div class="file-uploader">
                <label for="uploadFile">Upload an image</label>
                <input type="file" id="id-add-news-image" name="image">
                <p class="help-block">Image file has 2mb size restriction.</p>
              </div>
            </div>
          </div>
          <div class="clearfix"></div>
        </div>
        <div class="modal-footer actions">
          <button class="btn btn-primary" id="submitNewBtn" type="submit"> Submit</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
<</div>
<!-- Modal for Edit News -->
<div id="editNews" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h2 class="modal-title">Edit News</h2>
        <span class="orange">Required fields*</span>
      </div>
      <div id="newsEditMessage" class="hide">
        <div class="modal-body indent">
          <h1 class="text-center"><span class="icon icon-thank-you-o" style="font-size: 150px;"></span></h1>
          <p class="text-center" style="font-size: 20px;">Your news post has been successfully updated.</p>
        </div>
        <div class="modal-footer">
          <button id="newsEditModalClose" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      <div class="modal-body">
        <form id="newsEditForm" name="newsEditForm" action="" enctype="multipart/form-data" method="POST">
          <div class="row">
            <input type="hidden" name="communityID" value=""/>
            <input type="hidden" name="newsID" value=""/>

            <div id="newsAlertEdit" class="alert alert-warning hidden"></div>

            <div class="form-group col-md-12">
              <label for="Headline"  data-original-title="This news story will not appear on the site until it is approved." data-placement="right"
                     data-toggle="tooltip">Approved <span class="glyphicon glyphicon-question-sign"></span> </label> 
              <input type="checkbox" id="" data-checkbox="" name="approved" class="approveNews" data-approved="" data-on-color="success" data-on-text="Yes" data-off-text="No">
            </div>
            <div class="form-group col-md-12">
              <label for="Headline">Headline<span class="orange">*</span></label>
              <input class="form-control" id="Headline" name="headline" placeholder="Headline" value="">
              <div class="errorTxt"></div>
            </div>
            <div class="form-group">
              <div class="col-sm-6">
                <label>Publish Date<span class="orange">*</span></label>
                <div class="input-group">
                  <div id="releaseDateIconEdit" class="input-group-addon">
                    <i class="fa fa-calendar"></i>
                  </div>
                  <div class="add-date">
                    <input style="z-index: 10000" type="text" class="form-control pull-right" name="releaseDate"
                           id="releaseDateEdit" placeholder="Publish Date">
                  </div>
                </div>
                <div class="errorTxt"></div>
                <br/>
              </div>
            </div>
            <div class="form-group col-md-12">
              <label for="category" data-original-title="Start typing any tag you wish and press the comma key to add it. Enter as many as you like." data-placement="right"
                     data-toggle="tooltip">Category Tags <span class="glyphicon glyphicon-question-sign"></span></label>
              <input class="form-control" id="category-edit" name="categories" placeholder="Add tags to help categorize your news. Press the comma key after typing each tag.">
            </div>
            <div class="form-group col-md-12">
              <label for="contentEdit">Body Content<span class="orange">*</span></label>
              <textarea class="form-control ckeditor" id="contentEdit" name="content" placeholder="" rows="8" value=""></textarea>
            </div>
            <div class="form-group col-lg-4">
              <label for="currentImage">Current image</label>
              <img src="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/images/default-logo.png" class="img-responsive" alt="" name="current-image">
              <!--<div class="no-image hidden"><i class="fa fa-file-image-o"></i></div>-->
              <!--<p class="help-block hidden">No image uploaded.</p>-->
            </div>
            <div class="form-group col-lg-8">
              <div class="file-uploader">
                <label for="uploadFile">Upload a new image</label>
                <input type="file" id="image" name="image" size="50">
                <p class="help-block">Image file has 2mb size restriction.</p>
              </div>
            </div>
          </div>
          <div class="clearfix"></div>
          <div class="modal-footer actions">
            <button type="submit" class="btn btn-primary"><i class="fa fa-floppy-o"></i> Save</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Delete News -->
<div id="deleteNews" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header text-center">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h1><span class="icon icon-warning-o"></span></h1>
        <h3>Are you sure you want to delete this news?</h3>
      </div>
      <div class="modal-body text-center hidden">
      </div>
      <div class="modal-footer actions">
        <button id="id-delete-btn" type="button" class="btn btn-primary" data-dismiss="modal" data-community-url="" data-news-url="" onclick="deleteNewsPost(this)"><i class="fa fa-trash"></i> Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

{{> dashboard_sidebar_header activeId="id-com-mgmnt" activeSubId="id-com-news" }}

  <!-- Dashboard content wrapper (contains widgets & dashboard header) -->
  <div class="content-wrapper">

    <!-- Dashboard header -->
    <section class="content-header">
      <h1>Community Management <small>Manage News</small></h1>
    </section>

    <!-- Widgets content -->
    <section class="content">

      <div class="row">
        <section class="col-lg-12 connectedSortable community">
          <div class="box box-orange" id="manage_news">
            <div class="box-body">
              <div class="row">
                <div class="actions pull-right">
                {{#if userinfo.isOrgAdmin}}
                  <a class="btn btn-default btn-xs" data-toggle="modal" data-target="#addNews"><i class="fa fa-plus"></i> Add News</a>
                {{/if}}
                  <a href="#" data-toggle="tooltip" title="Public" class="panel-tooltip"><span class="icon icon-globe"></span></a>
                </div>
              </div>
              <div class="row">
                <div class="pull-left">
                  <!-- Filters -->
                  <div class="filters">
                    <div class="form-group filter-dropdown pull-right">
                      Sort by:
                      <select class="" id="id-sel-sort">
                        <option>Headline</option>
                        <option selected="selected">Publishing Date</option>
                        <option>Community Name</option>
                        <option>Publishing Status</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="pull-right">
                  <form class="form-horizontal dataTables_wrapper form-inline">
                    <div id="fileManager_filter" class="dataTables_filter"><label>Search:<input id="id-search-bar" type="search" class="form-control input-sm" placeholder="" aria-controls="fileManager"></label></div>
                  </form>
                </div>
              </div>
              <div class="row">
                <!-- The timeline -->
                <ul class="timeline no-line" id="id-ul-timeline">
                  {{#each communitiesAndNews}}
                    <!-- timeline item -->
                    <li id="id-news-{{news._id}}" class="">
                      <div class="timeline-item">
                        <span class="time"
                              data-sort="{{#isDateAndTimeReached news.releaseDate}}{{#if news.approved}}'published'{{else}}'not-published'{{/if}}{{else}}'not-published'{{/isDateAndTimeReached}}"><a
                          href="#" data-toggle="tooltip"
                          data-placement="left" {{#isDateAndTimeReached news.releaseDate}}
                                                  {{#if ../news.approved}}
                                                    title="Visible to the public."><span class="label label-success">Published
                                                  {{else}}
                                                    title="Not visible to the public."><span class="label label-default">Not Published
                                                  {{/if}}
                                                {{else}}
                                                  title="Not visible to the public."><span class="label label-default">Not Published
                                                {{/isDateAndTimeReached}}</span></a></span>
                        <a href="/community/about/{{urlFriendlyID}}/news/{{news.urlFriendlyID}}">
                          <div class="crop-wrapper">
                            <div class="crop"><img src="{{#if news.image}}
                                                          {{#if news.image.path}}
                                                            {{news.image.path}}
                                                          {{else}}
                                                            {{strings.PublicStaticContentDirectoryFullPrefixPath}}/images/logo-default.png
                                                          {{/if}}
                                                        {{else}}
                                                           {{strings.PublicStaticContentDirectoryFullPrefixPath}}/images/logo-default.png
                                                        {{/if}}" alt="{{news.headline}}" class="timeline-thumb">
                            </div>
                          </div>
                        </a>
                        <h3 class="timeline-header no-border" data-sort="{{news.headline}}"><a href="/community/about/{{urlFriendlyID}}/news/{{news.urlFriendlyID}}">{{news.headline}}</a></h3>
                        <p id="id-name-p" data-sort="{{name}}">Posted in the <a href="/community/about/{{urlFriendlyID}}#tab_about">{{name}}</a> community</p>
                        <p>Publishing Date: <span class="dates" data-sort="{{news.releaseDate}}">{{dateFormatter news.releaseDate 'short'}}</span></p>
                        {{#if ../userinfo.isOrgAdmin}}
                        <div class="actions">
                          <a class="btn btn-primary btn-xs" data-toggle="modal" data-target="#editNews" data-headline="{{news.headline}}"
                           data-release-date="{{news.releaseDate}}" data-categories="{{news.categories}}" data-content="{{news.content}}"
                           data-current-image={{#if news.image}}
                                                {{#if news.image.path}}
                                                  "{{news.image.path}}"
                                                {{else}}
                                                  "{{strings.PublicStaticContentDirectoryFullPrefixPath}}/images/logo-default.png"
                                                {{/if}}
                                              {{else}}
                                                "{{strings.PublicStaticContentDirectoryFullPrefixPath}}/images/logo-default.png"
                                              {{/if}}
                           data-approve-news="{{news.approved}}" data-community-url="{{urlFriendlyID}}" data-news-url="{{news.urlFriendlyID}}"
                           data-username="{{../../userinfo.username}}"
                           ><i class="fa fa-pencil"></i> Edit</a>
                          <a class="btn btn-default btn-xs" data-toggle="modal" data-target="#deleteNews"
                            data-approve-news="{{news.approved}}" data-community-url="{{urlFriendlyID}}" data-news-url="{{news.urlFriendlyID}}" data-news-id="{{news._id}}"><i class="fa fa-trash"></i> Delete</a>
                        </div>
                        {{/if}}
                      </div>
                    </li>
                  {{/each}}
                </ul>
                <!-- // END timeline -->
              </div>
            </div><!-- /.box-body -->
          </div><!-- /.box -->
        </section><!-- ./col -->
      </div><!-- /.row -->
    </section>
  </div>
  <!-- /.content-wrapper -->
  {{> dashboard_sidebar_footer }}

  {{#contentFor 'pageCSS'}}
    <link rel="stylesheet" type="text/css"
          href="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/js/libs/jquery-ui-1.11.2/jquery-ui.css"/>
    <link href="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/css/jivango-datepicker.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/js/libs/tokenfield/css/bootstrap-tokenfield.css"/>
  {{/contentFor}}

{{#contentFor 'pageScripts'}}
<!-- CK Editor -->
<script type="application/javascript" src="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/js/libs/ckeditor/ckeditor.js"></script>
<!-- Bootstap Tokenfield -->
<script type="application/javascript" src="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/js/libs/tokenfield/bootstrap-tokenfield.js"></script>
<!-- Moment -->
<!--<script src="{{!strings.PublicStaticContentDirectoryFullPrefixPath}}/js/libs/moment.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>
<!-- Custom Functionality -->
<script type="application/javascript" src="{{strings.PublicStaticContentDirectoryFullPrefixPath}}/js/manage/manage-news-dashboard.js"></script>
<script>
$(document).ready(function() {
  // Sort by publish date on page load
  initialSortByPublishDate();
});
</script>
{{/contentFor}}
